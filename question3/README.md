# سوال ۳


## بارگیری داده‌های CSV به ردیس

### مراحل اجرا:

1. **اتصال به ردیس**:
   - ابتدا با استفاده از کتابخانه Redis، به ردیس متصل می‌شویم. اطلاعات اتصال شامل میزبان (localhost) و پورت (6379) و پایگاه داده (0) می‌باشد.

2. **مسیر فایل CSV**:
   - مسیر فایل CSV که شامل کد کشور و نام شهر است را مشخص می‌کنیم.

3. **تابع بارگیری داده‌ها**:
   - یک تابع تعریف شده است که وظیفه بارگیری داده‌ها از فایل CSV به ردیس را دارد.
   - با استفاده از `csv.DictReader`، داده‌ها از فایل CSV خوانده می‌شوند و به صورت دیکشنری قرار می‌گیرند.
   - سپس برای هر ردیف در فایل CSV، کد کشور و نام شهر استخراج شده و با استفاده از `r.sadd` (که مخفف Redis Set Add است) به ردیس اضافه می‌شوند.

4. **اجرای عملیات بارگیری**:
   - اگر کد این بخش اصلی اجرا شود (به معنی اجرای این فایل به عنوان یک اسکریپت اصلی)، تابع بارگیری داده‌ها اجرا می‌شود و پیام "داده‌های CSV با موفقیت به ردیس وارد شد" چاپ می‌شود.

## ایجاد API با استفاده از FastAPI

### مراحل اجرا:

1. **ایجاد برنامه FastAPI**:
   - با استفاده از کتابخانه FastAPI، یک برنامه ایجاد می‌شود.

2. **اتصال به ردیس**:
   - دوباره به ردیس متصل می‌شویم تا بتوانیم داده‌های موجود در آن را در API استفاده کنیم.

3. **تعریف یک مسیر برای API**:
   - با استفاده از دکوراتور `@app.get("/")`، یک مسیر برای API تعریف می‌کنیم که به آن `/` گفته می‌شود.
   - این مسیر یک پارامتر به نام `key` دریافت می‌کند که کد کشور را مشخص می‌کند.

4. **دریافت شهرها بر اساس کد کشور**:
   - با استفاده از `r.smembers(key)`، مجموعه‌ای از شهرها برای کد کشور ورودی گرفته شده از کاربر از ردیس بازیابی می‌شود.
   - در نهایت، این شهرها به عنوان یک لیست به کاربر ارسال می‌شود.

5. **اجرای سرور**:
   - در صورتی که کد این قسمت اصلی اجرا شود، سرور FastAPI با استفاده از `uvicorn` اجرا می‌شود، که در این حالت بر روی `127.0.0.1` و پورت `8000` قرار دارد.
